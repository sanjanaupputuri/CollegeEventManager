# College Management App - Documentation
## Part 4: Notifications & Reminders System

---

## 1. Notifications System Overview

### 1.1 Introduction

The Notifications System ensures users stay informed about events, registrations, and important updates through multiple channels. It leverages Firebase Cloud Messaging (FCM) for push notifications, email services for detailed communications, and optional SMS for critical alerts.

The system is designed to be non-intrusive yet effective, allowing users to customize their notification preferences while ensuring critical information reaches them through appropriate channels.

### 1.2 Notification Channels

| Channel | Purpose | Delivery Speed | User Control |
|---------|---------|----------------|--------------|
| Push Notifications | Real-time alerts and updates | Immediate | Full control via preferences |
| Email | Detailed information and summaries | Within minutes | Opt-in/opt-out per category |
| In-App Notifications | Activity feed and history | Real-time | Always enabled |
| SMS | Critical alerts only | Immediate | Opt-in with verification |

### 1.3 Notification Categories

**Event-Related**
- New event published matching user interests
- Event registration confirmation
- Event reminders (24h, 1h before)
- Event updates and changes
- Event cancellation alerts

**Registration-Related**
- Registration approval/rejection
- Waitlist position updates
- Waitlist promotion notifications
- Registration cancellation confirmations

**Attendance-Related**
- Check-in confirmation
- Certificate availability
- Attendance milestone achievements

**System-Related**
- Account verification
- Password reset
- System maintenance alerts
- Emergency broadcasts

**Academic-Related**
- Exam schedule updates
- Assignment deadlines
- Result announcements
- Fee payment reminders

**Social-Related**
- Club announcements
- Friend registered for event
- Event discussion replies
- Organizer responses to Q&A

---

## 2. Push Notifications System

### 2.1 Firebase Cloud Messaging (FCM) Setup

#### FCM Token Management

When users install the app and complete authentication, the system generates and stores an FCM token for each device. This token uniquely identifies the device for push notification delivery.

**Token Storage Structure**:
```
users/{userId}
  - fcmTokens: array
      - token: string
      - deviceType: string (android)
      - deviceId: string
      - deviceName: string
      - registeredAt: timestamp
      - lastUsed: timestamp
```

**Token Lifecycle**:
- Generated on first app launch after authentication
- Stored in user document under fcmTokens array
- Supports multiple devices per user
- Refreshed automatically when token expires
- Removed when user logs out or uninstalls app

#### Topic-Based Notifications

Users are automatically subscribed to relevant FCM topics based on their profile:

**Department Topics**: `department_computer_science`, `department_electronics`

**Year Topics**: `year_1`, `year_2`, `year_3`, `year_4`

**Category Topics**: `category_academic`, `category_sports`, `category_cultural`

**Club Topics**: `club_coding_club`, `club_music_society`

**General Topics**: `all_students`, `all_users`, `emergency_alerts`

Topic subscriptions update automatically when user profile changes (e.g., year advancement, club membership changes).

### 2.2 Notification Data Model

#### Firestore Notification Document Structure

```
notifications/{notificationId}
  - notificationId: string (auto-generated)
  - type: string (event/registration/attendance/system/academic)
  - category: string (specific subcategory)
  - title: string
  - body: string
  - priority: string (high/normal/low)
  - recipientType: string (individual/topic/role/all)
  - recipients: array (user IDs if individual, topics if broadcast)
  - data: object
      - eventId: string (if event-related)
      - registrationId: string (if registration-related)
      - actionUrl: string (deep link)
      - imageUrl: string (notification image)
      - actionButtons: array (optional action buttons)
  - deliveryStatus: object
      - sent: number (count of sent notifications)
      - delivered: number (confirmed deliveries)
      - opened: number (notification taps)
      - failed: number (failed deliveries)
  - scheduledTime: timestamp (for scheduled notifications)
  - sentTime: timestamp
  - expiryTime: timestamp
  - isRead: map (userId: boolean) // for in-app notifications
  - createdBy: string (userId or system)
  - createdAt: timestamp
```

### 2.3 Push Notification Types

#### Event Announcement Notifications

**Trigger**: New event published matching user's interests or target audience

**Title**: "New {Category} Event: {Event Title}"

**Body**: "{Event Title} on {Date} at {Venue}. Tap to register!"

**Data Payload**:
- Event ID for deep linking
- Event poster thumbnail URL
- Quick action: "Register" button

**Delivery Logic**:
- Sent to users matching event's target audience (department, year)
- Interest-based filtering for better relevance
- Batch sent to avoid overwhelming users (max 3 events per day)

#### Registration Confirmation Notifications

**Trigger**: Successful event registration

**Title**: "Registration Confirmed: {Event Title}"

**Body**: "You're registered for {Event Title} on {Date}. Check-in details sent to your email."

**Data Payload**:
- Registration ID
- QR code URL
- Quick actions: "View Ticket", "Add to Calendar"

**Delivery**: Immediate upon registration completion

#### Event Reminder Notifications

**Trigger**: Scheduled reminders before event (24 hours, 1 hour)

**24-Hour Reminder**:
- Title: "Reminder: {Event Title} Tomorrow"
- Body: "{Event Title} is scheduled for tomorrow at {Time}. Venue: {Venue Name}"
- Actions: "View Details", "Get Directions"

**1-Hour Reminder**:
- Title: "Starting Soon: {Event Title}"
- Body: "{Event Title} starts in 1 hour at {Venue}. Don't forget to bring your ticket!"
- Actions: "View Ticket", "Navigate"
- Priority: High (for reliable delivery)

#### Waitlist Promotion Notifications

**Trigger**: User moved from waitlist to confirmed

**Title**: "Great News! You're Off the Waitlist"

**Body**: "A spot opened up for {Event Title}. Confirm your registration within 24 hours."

**Data Payload**:
- Registration ID
- Confirmation deadline timestamp
- Quick action: "Confirm Registration" button

**Delivery**: Immediate with high priority

#### Event Update Notifications

**Trigger**: Organizer updates critical event details (date, time, venue)

**Title**: "Important Update: {Event Title}"

**Body**: "{Change Description}. New {Changed Field}: {New Value}"

**Data Payload**:
- Event ID
- Change summary (old vs. new values)
- Quick action: "View Updated Details"

**Delivery**: Immediate to all registered participants

#### Event Cancellation Notifications

**Trigger**: Event cancelled by organizer

**Title**: "Event Cancelled: {Event Title}"

**Body**: "{Event Title} scheduled for {Date} has been cancelled. {Reason}"

**Data Payload**:
- Event ID
- Cancellation reason
- Registration refund status (if applicable)

**Delivery**: Immediate with high priority to all registered users

### 2.4 Notification Delivery Optimization

#### Batching Strategy

To prevent notification fatigue, the system batches non-urgent notifications:

**Daily Digest** (8:00 AM):
- New events published yesterday
- Upcoming events this week
- Pending action items

**Weekly Summary** (Sunday 6:00 PM):
- Week ahead preview
- Popular events you might like
- Registration deadlines approaching

**Intelligent Grouping**:
- Multiple updates for same event grouped into single notification
- Similar notifications collapsed ("3 new events in Cultural category")

#### Do Not Disturb

The system respects quiet hours (10:00 PM - 8:00 AM by default):
- Low priority notifications queued until morning
- High priority notifications delivered immediately (emergency alerts)
- User-configurable quiet hours in settings

#### Delivery Timing Optimization

Machine learning algorithms analyze user behavior to optimize delivery timing:
- Identify when user is most active in app
- Schedule non-urgent notifications for high-engagement times
- Avoid sending notifications during classes (if timetable integrated)

---

## 3. Reminder System

### 3.1 Scheduled Reminders

#### Cloud Functions for Reminders

Firebase Cloud Functions run scheduled tasks (cron jobs) to send event reminders at configured intervals.

**Reminder Schedule Configuration**:
```
reminder_settings/{eventId}
  - eventId: string
  - reminders: array
      - timeBeforeEvent: number (in hours)
      - enabled: boolean
      - customMessage: string (optional)
      - channels: array (push/email/sms)
```

**Default Reminder Schedule**:
- 24 hours before event
- 1 hour before event
- At event start time (for virtual events with join link)

**Custom Reminders**:
- Organizers can add custom reminder intervals
- Maximum 5 reminders per event
- Minimum 15 minutes between reminders

#### Reminder Processing Logic

**Step 1: Identify Eligible Events**

Cloud Function runs every 15 minutes, querying events with start time in the next 24 hours (or 1 hour for second reminder). Events must be published and not cancelled.

**Step 2: Fetch Registered Users**

For each eligible event, fetch all confirmed registrations where reminder hasn't been sent yet. Exclude users who have disabled reminders for this event category.

**Step 3: Generate Reminder Content**

Create personalized reminder message including:
- Event details (title, time, venue)
- User's registration confirmation number
- QR code for check-in
- Any last-minute updates from organizer

**Step 4: Send Through Channels**

Deliver reminders via all enabled channels (push, email, SMS). Update notification tracking to prevent duplicate sends.

**Step 5: Mark as Sent**

Update registration document with reminder sent timestamp to prevent duplicate reminders.

### 3.2 Personalized Reminders

#### Context-Aware Reminders

Reminders adapt content based on user context:

**Location-Based**: If user location services enabled, include travel time estimate and route suggestion.

**Weather-Based**: Include weather forecast for event time ("Pack an umbrella, rain expected").

**Conflict Warnings**: Alert if user has overlapping registrations ("Note: You have another event at 3:00 PM").

**Preparation Reminders**: Include items to bring based on event category ("Remember to bring your laptop and charger").

#### Smart Reminder Suggestions

The system suggests optimal reminder times based on:
- Event type (workshops need earlier reminders for preparation)
- Venue distance from user's typical location
- User's past attendance patterns
- Event popularity and expected crowd

### 3.3 Reminder Preferences

#### User-Controlled Settings

Users customize reminder behavior through Settings > Notifications > Reminders:

**Reminder Timing**:
- Enable/disable 24-hour reminder
- Enable/disable 1-hour reminder
- Add custom reminder (e.g., 2 days before, 30 minutes before)

**Delivery Channels** (per reminder type):
- Push notification: Yes/No
- Email: Yes/No
- SMS: Yes/No (requires phone verification)

**Category-Specific Settings**:
- Different reminder preferences for each event category
- Example: Push only for sports, email for academic

**Smart Snooze**:
- Snooze reminder for 15/30/60 minutes
- Limit snoozes to prevent missing event

---

## 4. Email Notification System

### 4.1 Email Service Integration

#### Email Provider Setup

The app integrates with email services through Firebase Extensions or third-party services:

**Options**:
- SendGrid Firebase Extension
- Mailgun
- Amazon SES
- Custom SMTP server

**Configuration**:
- Sender email address (noreply@college.edu)
- Reply-to address (support@college.edu)
- DKIM and SPF records for deliverability
- Template storage in Cloud Firestore or email provider

### 4.2 Email Types and Templates

#### Registration Confirmation Email

**Subject**: "Registration Confirmed - {Event Title}"

**Content**:
- Personalized greeting with student name
- Event poster banner image
- Registration confirmation message with ID
- Complete event details table (date, time, venue, organizer)
- QR code ticket (embedded as image)
- Add to Calendar button (.ics attachment)
- Venue directions link
- Cancellation policy and instructions
- Footer with support contact and social links

**Design**: Professional HTML template with responsive design for mobile viewing

#### Event Reminder Email

**24-Hour Reminder Subject**: "Tomorrow: {Event Title}"

**Content**:
- Friendly reminder opening
- Event details summary
- Countdown timer ("Event in 24 hours")
- QR code ticket reminder
- What to bring checklist (if applicable)
- Parking and transportation information
- Organizer message (if any)
- Quick links: View Details, Cancel Registration

**1-Hour Reminder Subject**: "Starting Soon: {Event Title}"

**Content**:
- Urgent but friendly tone
- Event starting in 1 hour notice
- Venue details with map image
- QR code prominently displayed
- Last-minute instructions from organizer
- Contact information for queries

#### Event Update Email

**Subject**: "Important Update: {Event Title} - {Change Type}"

**Content**:
- Clear notice of update
- Comparison table (Old vs. New details)
- Reason for change (if provided by organizer)
- Updated QR code if needed
- Option to cancel registration if change doesn't suit
- Contact organizer link for questions

#### Certificate Available Email

**Subject**: "Your Certificate for {Event Title} is Ready"

**Content**:
- Congratulations message
- Event name and attendance confirmation
- Certificate preview thumbnail
- Download certificate button (secure link)
- Share certificate options
- Verification instructions
- Feedback request for the event

### 4.3 Email Delivery Management

#### Sending Queue

Emails are queued in Firestore for reliable delivery:

```
email_queue/{emailId}
  - emailId: string
  - to: string (recipient email)
  - toName: string (recipient name)
  - subject: string
  - templateId: string
  - templateData: object (variables for template)
  - priority: string (high/normal/low)
  - status: string (queued/sent/failed)
  - attempts: number
  - scheduledTime: timestamp
  - sentTime: timestamp
  - failureReason: string
  - createdAt: timestamp
```

**Processing Flow**:
1. Email request added to queue by Cloud Function
2. Background worker processes queue (priority order)
3. Render email from template with data
4. Send via email provider API
5. Update status based on provider response
6. Retry failed emails (max 3 attempts)
7. Log delivery for analytics

#### Delivery Tracking

The system tracks email metrics:
- Sent count and rate
- Delivery success rate
- Bounce rate (invalid addresses)
- Open rate (if tracking enabled)
- Click-through rate on links
- Unsubscribe rate per email type

#### Unsubscribe Management

Each email includes unsubscribe link for non-critical notifications. Users can unsubscribe from:
- Event announcement emails
- Reminder emails
- Newsletter/digest emails

Critical emails (registration confirmations, cancellations, account security) cannot be unsubscribed.

---

## 5. SMS Notification System (Optional)

### 5.1 SMS Integration

#### SMS Gateway Setup

Integration with SMS providers for critical alerts:

**Supported Providers**:
- Twilio
- MSG91 (popular in India)
- AWS SNS
- TextLocal

**Configuration**:
- API credentials stored securely
- Sender ID registration
- DLT (Distributed Ledger Technology) template registration for India
- Rate limiting to control costs

### 5.2 SMS Use Cases

#### Critical Alerts Only

SMS is used sparingly due to cost and intrusiveness:

**Emergency Alerts**:
- Campus emergencies
- Event cancellations (immediate notification needed)
- Security alerts

**Important Reminders**:
- Exam schedule changes
- Result announcements
- Fee payment deadline

**OTP and Verification**:
- Phone number verification
- Two-factor authentication
- Password reset verification

### 5.3 SMS Content Guidelines

**Character Limit**: Keep messages under 160 characters for single SMS

**Clear and Direct**: No marketing language, straight to the point

**Include Link**: Shortened URL to app for more details

**Example SMS Templates**:

```
Emergency Alert: Campus closed today due to heavy rain. All events postponed. Check app for updates. - {College Name}

Reminder: {Event Title} starts in 1 hour at {Venue}. Show QR code at entry. Details: {short-url}

Your exam schedule is now available. Download from app: {short-url} - {College Name}
```

---

## 6. In-App Notification Center

### 6.1 Notification Feed

#### Feed Interface

The notification center is accessible from the main navigation bar with a bell icon showing unread count badge.

**Feed Layout**:
- Reverse chronological order (newest first)
- Grouped by date (Today, Yesterday, This Week, Earlier)
- Category icons and colors for visual distinction
- Swipe actions (mark read, delete)
- Pull-to-refresh for latest notifications

**Notification Card Design**:
```
┌─────────────────────────────────────┐
│ [Icon] Event Title               • │
│        Notification message         │
│        2 hours ago                  │
│        [Action Button]              │
└─────────────────────────────────────┘
```

#### Notification States

**Unread**: Bold text, blue accent, unread indicator dot

**Read**: Normal text, gray text color, no indicator

**Archived**: Moved to separate "Archived" tab, hidden from main feed

**Expired**: Auto-removed after 30 days (configurable)

### 6.2 Notification Actions

#### Inline Actions

Notifications support quick actions without leaving the feed:

**Event Notifications**:
- "Register" button for new events
- "View Details" opens event screen
- "Add to Calendar" quick action

**Registration Notifications**:
- "View Ticket" opens QR code
- "Cancel Registration" with confirmation

**Waitlist Notifications**:
- "Confirm Registration" for promotions
- "Decline" with reason optional

#### Swipe Gestures

**Swipe Left**: Delete notification with confirmation

**Swipe Right**: Mark as read/unread toggle

**Long Press**: Multi-select mode for batch actions

### 6.3 Notification Filtering

#### Filter Options

Users can filter notifications by:
- Category (Events, Registrations, Academic, System)
- Status (Unread, All, Archived)
- Date range (Today, This Week, This Month, Custom)
- Event category (for event-related notifications)

#### Search Functionality

Search bar allows finding specific notifications by:
- Event name
- Keyword in message
- Organizer name
- Date range

---

## 7. Notification Preferences

### 7.1 Preference Management

#### Granular Control

Settings > Notifications provides comprehensive control:

**By Category** (Enable/Disable):
- Event announcements
- Registration confirmations
- Event reminders
- Event updates
- Waitlist notifications
- Academic updates
- Club announcements
- System notifications

**By Channel** (for each category):
- Push notifications: On/Off
- Email: On/Off
- SMS: On/Off (for supported categories)

**By Interest**:
- Receive notifications only for preferred event categories
- Interest-based event recommendations
- Friend activity notifications

#### Quick Toggles

**Do Not Disturb Mode**:
- Silent all notifications except critical
- Schedule quiet hours
- Override for emergency alerts

**Notification Sound**:
- Default system sound
- Custom sound selection
- Vibration pattern
- LED color (if supported)

**Summary Mode**:
- Instead of individual notifications, receive daily/weekly digest
- Configurable digest time
- Email or in-app summary

### 7.2 Default Preferences

#### New User Defaults

All users start with sensible defaults:
- Push notifications: Enabled for all categories
- Email: Enabled for confirmations and reminders only
- SMS: Disabled (opt-in required)
- Quiet hours: 10:00 PM - 8:00 AM
- Reminders: Both 24h and 1h enabled

#### Role-Based Defaults

Different defaults for different user roles:

**Students**:
- All event categories enabled
- Department-specific events prioritized

**Faculty**:
- Organizer notifications enabled
- Event management alerts enabled
- Analytics summary emails weekly

**Admins**:
- System health notifications enabled
- User report alerts enabled
- All event notifications disabled by default

### 7.3 Notification Permissions

#### Android Permission Handling

The app requests notification permissions following Android best practices:

**Initial Request**: On first launch after signup, explain notification benefits before requesting permission

**Contextual Requests**: Request permission when user performs action that triggers notifications (e.g., registering for event)

**Graceful Degradation**: If permission denied, show in-app message about missing notifications and provide settings shortcut

**Permission Status Tracking**:
```
users/{userId}/preferences
  - notificationPermission: string (granted/denied/not_requested)
  - permissionRequestCount: number
  - lastPermissionRequestTime: timestamp
```

---

## 8. Notification Analytics

### 8.1 Delivery Metrics

#### System-Wide Analytics

Admin dashboard displays notification health metrics:

**Delivery Statistics**:
- Total notifications sent (daily/weekly/monthly)
- Delivery success rate by channel
- Average delivery time
- Failed deliveries with reasons

**User Engagement**:
- Open rate (percentage of notifications tapped)
- Action rate (percentage resulting in user action)
- Dismissal rate
- Unread accumulation patterns

**Channel Performance**:
- Push vs. Email vs. SMS effectiveness
- Best performing notification types
- Optimal delivery timing analysis

### 8.2 Event-Specific Metrics

#### Per-Event Tracking

Organizers view notification effectiveness for their events:

**Announcement Reach**:
- Number of users notified about event
- Notification open rate
- Registration conversion from notification

**Reminder Effectiveness**:
- Reminder delivery count
- Attendance correlation with reminder opens
- Optimal reminder timing for future events

**Update Notifications**:
- Update notification reach
- Acknowledgment rate
- Cancellation rate after updates

### 8.3 A/B Testing

#### Notification Optimization

The system supports A/B testing for notification content:

**Test Variables**:
- Notification title variations
- Message copy variations
- Send timing (morning vs. evening)
- Reminder intervals
- Image inclusion impact

**Test Groups**: Users randomly assigned to test groups for controlled experiments

**Metrics**: Compare open rates, action rates, and conversion between variants

**Implementation**: Best performing variant automatically becomes default after statistically significant results

---

## 9. Notification Best Practices

### 9.1 Content Guidelines

#### Writing Effective Notifications

**Be Concise**: Deliver key information in first 40 characters (visible in collapsed view)

**Be Specific**: Include event name, date, and action required

**Be Actionable**: Always include relevant action (Register, View, Confirm)

**Be Timely**: Send at optimal times when user likely to engage

**Be Personal**: Use user's name when appropriate, reference past interactions

#### Tone and Language

**Friendly yet Professional**: Match institutional voice

**Clear and Direct**: Avoid jargon, use simple language

**Culturally Appropriate**: Consider diverse student body

**Urgency Indicators**: Use sparingly and only when genuinely urgent

### 9.2 Frequency Management

#### Preventing Notification Fatigue

**Daily Limits**: Maximum 5 notifications per user per day (excluding critical)

**Intelligent Grouping**: Combine similar notifications into single message

**User Feedback**: Monitor unsubscribe rates and opt-out patterns

**Gradual Scaling**: New users receive fewer notifications initially

### 9.3 Testing and Quality Assurance

#### Pre-Launch Checklist

- Test notifications on multiple Android versions
- Verify deep links work correctly
- Check notification appearance in expanded/collapsed states
- Test notification actions
- Verify notification sounds and vibrations
- Check behavior with Do Not Disturb mode
- Test notification grouping and stacking

#### Monitoring and Maintenance

- Monitor delivery failure rates
- Track user feedback and complaints
- Regular review of notification performance
- Update templates based on engagement data
- Seasonal adjustments (exam periods, holidays)

---
